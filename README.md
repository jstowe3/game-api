# game_api

How to start the game_api application
---

1. Run `mvn clean install` to build your application
1. Start application with `java -jar target/game_api-1.0.jar server config.yml`
1. To check that your application is running enter url `http://localhost:8080`

Health Check
---

To see your applications health enter url `http://localhost:8081/healthcheck`

Redis
---

Configure your redis connection via config.yml.
Default host is "127.0.0.1" using the default Redis port (6379).

RedisHelper.java defines keys for each of the main indexes and data structures.
Currently this service supports a connection with a single Redis instance, but it can be extended to user a Redis Cluster.

- "zRatingFeedbackIndex" is of the form: {rating}:{0-padded-feedback-id} with all scores set to 0.  This way we can take advantage of lexicographical order using commands like [ZRANGEBYLEX](https://redis.io/commands/zrangebylex).

- "NEXT_FEEDBACK_ID" is used as a incremental counter for generating Feedback-IDs.

- "zRatingIndex" is an index sorting Feedback-keys by their respective ratings (1-5).

- "zFeedbackIdIndex" is an index sorting Feedback-keys by their respective ids (generated by NEXT_FEEDBACK_ID).

- "sSessionFeedbackUsers:" is used as a key-prefix to map many user-ids to one-session-id in a Redis set. 
    - Ex Key: "sSessionFeedbackUsers:session-id-12345"
    - Ex Member: "user-id-12345"
    
- "Feedback:" is a prefix used for individual Feedback-hashes.

    - Ex Key: "Feedback:123"
    
API Endpoints
---

- POST
/review/{session_id}

    - Params
        
        - Post-body (x-www-form-urlencoded)
        
            - **key**: "rating" **value**: int (1-5) *required*
            - **key**: "comment" **value**: String (max-length 100) *optional*
            
        - Headers
        
            - **key**: X-UserId **value**: String (user-id) *required*
            
        - Path
        
            - {session_id} String *required*

    - 200 Success Example:
    ```
    {
       "id": 26,
       "rating": 5,
       "userId": "test_user_id_18",
       "sessionId": "test_session_id_5",
       "comment": "love it!"
    }
     ```
    

- GET 
/review/recent

    - Optional Query Params:
        
        - **key** "maxRating" **value** int (1-5)
        - **key** "minRating" **value** int (1-5)

    - 200 Success Example:
    ```
    [
        {
            "id": 24,
            "rating": 1,
            "userId": "test_user_id_18",
            "sessionId": "test_session_id_3",
            "comment": "love it!"
        },
        {
            "id": 23,
            "rating": 1,
            "userId": "test_user_id_18",
            "sessionId": "test_session_id_2",
            "comment": "love it!"
        },
        {
            "id": 22,
            "rating": 1,
            "userId": "test_user_id_17",
            "sessionId": "test_session_id_2",
            "comment": "love it!"
        },
        {
            "id": 21,
            "rating": 1,
            "userId": "test_user_id_16",
            "sessionId": "test_session_id_2",
            "comment": "love it!"
        },
        {
            "id": 20,
            "rating": 1,
            "userId": "test_user_id_15",
            "sessionId": "test_session_id_2",
            "comment": "love it!"
        },
        {
            "id": 17,
            "rating": 1,
            "userId": "test_user_id_12",
            "sessionId": "test_session_id_2",
            "comment": "love it!"
        },
        {
            "id": 10,
            "rating": 1,
            "userId": "test_user_id_7",
            "sessionId": "test_session_id_2",
            "comment": "love it!"
        }
    ]
    ```



